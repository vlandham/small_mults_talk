<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="css/prism.css" />
<style>

  @import url(http://fonts.googleapis.com/css?family=PT+Serif|PT+Serif:b|PT+Serif:i);

  pre[class*="language-"] {
    background: #fff;
  }
  

section {
  background: #fff;
  color: #000;
  padding: 2em;
  font-family: "PT Serif", Baskerville, Georgia;
}

#follow {
  background: none;
}

.grey {
  color: #777;
}

.center {
  text-align: center;
  font-size: 120%;
}

.title {
  text-align:center;
  font-size:500%;
  /* line-height: 1.2; */
}

.caption {
  position: absolute;
  right: 2%;
  bottom: 0%;
  color: #777;
}

.rcaption {
  position: absolute;
  right: 2%;
  bottom: 0%;
  color: #777;
}

a:link,
a:visited {
  color: orange;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

video {
  /* width: 100%; */
  margin: 0 auto;
  display: block;
}

</style>
<div id="pagenumber" style="z-index:100;position:fixed;left:1%;bottom:7%;"></div>

<section style="text-align:center;padding-top:5em;">
<p style="font-size:120%;"><b>Interactive Small Multiples</b></p>
<p>Jim Vallandingham</p>
  <div id="arrow" style="opacity: 1;">
    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="35px" height="20px" viewBox="0 0 35 20" enable-background="new 0 0 35 20" xml:space="preserve">
    <polyline fill="none" stroke="#231F20" stroke-width="6.6008" stroke-miterlimit="10" points="4,3.988 17.756,13.743 30.342,3.988 
    "></polyline>
    </svg>
  </div>
  
</section>

<section style="text-align:center;padding-top:5em;">
<p><a href="http://lenagroeger.s3.amazonaws.com/talks/nicar/weethings.html#/1">Wee Little Things</a></p>
<p>Lena Groeger
</section>

<section style="padding-top:5em;background:url(img/waldo.jpg);background-size:cover;">
</section>

<section style="padding-top:2em;">
<img src="img/minimaps_sub.jpg" style="width:100%"/>
</section>

<section style="padding-top:2em;">
<img src="img/murray.png" style="width:100%"/>
</section>

<section>
  <video loop>
    <source src="video/manifest.mp4" type="video/mp4" />
    </video>
    <p class="caption"><a href="http://michaelporath.com/projects/manifest-destiny/#overview">manifest destiny</a></p>
    </section>



<section style="text-align:center;padding-top:5em;">
<p>Small multiples use the same basic graphic or chart to display difference slices of a data set
</section>

<section style="text-align:center;padding-top:5em;">
<p>A chorus of little stories to help tell a bigger one.
</section>

<section style="text-align:center;padding-top:5em;">
<p class="title">Uses</p>
</section>

<section style="padding-top:4em;text-align:center;">
<img src="img/SmallMultiples2.png" style=""/>
    <p class="caption"><a href="http://stephanieevergreen.com/declutter-dataviz-with-small-multiples/">declutter dataviz</a></p>
</section>

<section style="padding-top:4em;text-align:center;">
<img src="img/SmallMultiples33.png" style="width:100%"/>
    <p class="caption"><a href="http://stephanieevergreen.com/declutter-dataviz-with-small-multiples/">declutter dataviz</a></p>
</section>

<section>
  <video loop>
    <source src="video/drought.mp4" type="video/mp4" />
    </video>
    <p class="caption"><a href="http://www.latimes.com/la-me-g-california-drought-map-gif-htmlstory.html/">latimes.com</a></p>
    </section>

<section style="padding-top:1em;text-align:center;">
<img src="img/drought.jpg" style="width:100%"/>
    <p class="caption"><a href="http://www.latimes.com/la-me-g-california-drought-map-gif-htmlstory.html/">latimes.com</a></p>
</section>

<section style="text-align:center;padding-top:5em;">
<p style="font-size:200%">Origins</p>
</section>

<section style="text-align:center;padding-top:5em;">
<p style="font-size:200%">Tufte</p>
</section>

<!-- <section style="text-align:center;padding-top:5em;"> -->
<!-- <p>Illustrations of postage-stamp size are indexed by category or a label, sequenced over time like the frames of a movie, or ordered by a quantitative variable not used in the single image itself.   -->
<!-- </section> -->

<section style="text-align:center;padding-top:4em;">
<img src="img/church_1890_inset_l.jpg" style="width:100%"/>
</section>

<section style="text-align:center;padding-top:1em;">
<img src="img/church_remake.png" style="height:100%"/>
</section>

<section style="text-align:center;padding-top:1em;">
<img src="img/deaths_1870.jpg" style="height:100%"/>
</section>

<section style="text-align:center;padding-top:3em;background:url(img/disease_zoom.jpg);background-size:cover;">
<!-- <img src="img/deaths_1870_inset.png" style="width:100%"/> -->
</section>

<!-- <section style="text-align:center;padding-top:3em;"> -->
<!-- <img src="img/deaths_1870_inset.png" style="width:100%"/> -->
<!-- </section> -->

<section style="text-align:center;padding-top:5em;">
<p class="title">Interaction</p>
</section>

<section>
  <video loop>
    <source src="video/manifest.mp4" type="video/mp4" />
    </video>
    <p class="caption"><a href="http://michaelporath.com/projects/manifest-destiny/#overview">manifest destiny</a></p>
    </section>

<section style="text-align:center;padding-top:5em;">
<p class="title">Linked</p>
</section>

<section style="text-align:center;padding-top:5em;">
<p class="title">Updateable</p>
</section>

<section>
  <video loop>
    <source src="video/githut.mp4" type="video/mp4" />
    </video>
    <p class="caption"><a href="http://githut.info/">githut.info</a></p>
    </section>

<section>
  <video loop>
    <source src="video/cancer.mp4" type="video/mp4" />
    </video>
    <p class="caption"><a href="http://www.nytimes.com/interactive/2013/12/20/health/a-racial-gap-in-breast-cancer-deaths.html?_r=0">cancer racial gap</a></p>
</section>

<section style="text-align:center;padding-top:5em;">
  <p class="title">Sortable</p>
</section>

<section>
  <video loop>
    <source src="video/kepler.mp4" type="video/mp4" />
    </video>
    <p class="caption"><a href="http://www.nytimes.com/interactive/science/space/keplers-tally-of-planets.html">kepler tally</a></p>
</section>

<section>
  <video loop>
    <source src="video/ambulance_sort.mp4" type="video/mp4" />
    </video>
    <p class="caption"><a href="https://projects.propublica.org/graphics/ambulances">ambulances</a></p>
</section>


<section style="text-align:center;padding-top:5em;">
<p class="title">Highlightable</p>
</section>

<section>
  <video loop>
    <source src="video/middle_class.mp4" type="video/mp4" />
    </video>
    <p class="caption"><a href="http://www.nytimes.com/2014/04/23/upshot/the-american-middle-class-is-no-longer-the-worlds-richest.html?abt=0002&abg=1">middle classes</a></p>
</section>

<section style="text-align:center;padding-top:3em;">
<img src="img/eu_unemploy.png" style="width:100%"/>
</section>

<section>
  <video loop>
    <source src="video/stock.mp4" type="video/mp4" />
    </video>
</section>

<section style="text-align:center;padding-top:5em;">
<p class="title">Scrubbable</p>
</section>

<section>
  <video loop>
    <source src="video/tax_rate.mp4" type="video/mp4" />
    </video>
    <p class="caption"><a href="http://www.nytimes.com/interactive/2012/11/30/us/tax-burden.html">tax burden</a></p>
    </section>

<!-- <section style="text-align:center;padding-top:3em;"> -->
<!-- <img src="img/deaths_1870_inset.png" style="width:100%"/> -->
<!-- </section> -->

<section style="text-align:center;padding-top:3em;background:url(img/disease_zoom.jpg);background-size:cover;">
<!-- <img src="img/deaths_1870_inset.png" style="width:100%"/> -->
</section>

<section style="text-align:center;padding-top:3em;">
  <video loop>
    <source src="video/tax_rate_2.mp4" type="video/mp4" style="width:100%;" />
    </video>
    <p class="caption"><a href="http://www.nytimes.com/interactive/2012/11/30/us/tax-burden.html">tax burden</a></p>
</section>


<section>
  <video loop>
    <source src="video/unplanned.mp4" type="video/mp4" />
    </video>
    <p class="caption"><a href="http://www.nytimes.com/interactive/2014/09/14/sunday-review/unplanned-pregnancies.html?smid=tw-share">unplanned pregnancies</a></p>
    </section>

<section style="text-align:center;padding-top:3em;">
  <video loop>
    <source src="video/fracking.mp4" type="video/mp4" style="width:100%;" />
    </video>
    <p class="caption"><a href="">fracking</a></p>
</section>


<!-- <section> -->
<!--   <video loop> -->
<!--     <source src="video/ambulance_scrub.mp4" type="video/mp4" /> -->
<!--     </video> -->
<!--     <p class="caption"><a href="https://projects.propublica.org/graphics/ambulances">ambulances</a></p> -->
<!--     </section> -->


<section style="text-align:center;padding-top:5em;">
<p class="title">Brushable</p>
</section>

<section>
  <video loop>
    <source src="video/scatter.mp4" type="video/mp4" />
    </video>
    <p class="caption"><a href="http://bl.ocks.org/mbostock/4063663">brushable scatterplot</a></p>
    </section>

<section style="text-align:center;padding-top:5em;">
  <p class="title">Implementation</p>
</section>


<section style="text-align:center;padding-top:3em;background:url(img/askmeta.jpg);background-size:cover;">
<!-- <img src="img/deaths_1870_inset.png" style="width:100%"/> -->
  <p class="title">MetaFilter</p>
</section>

<section style="padding-top:5em;">
<img src="img/metafilter_traffic.png" style="width:100%"/>
</section>

<section style="text-align:center;padding-top:3em;background:url(img/metadata.png);background-size:cover;">
  <p class="title">Data</p>
</section>

<section style="text-align:center;padding-top:1em;">
    <pre ><code class="language-javascript">
"year"  "category"  "n"
"2004"  "clothing, beauty, & fashion"   141
"2004"  "computers & internet"  2489
"2004"  "education" 151
"2005"  "clothing, beauty, & fashion"   203
"2005"  "computers & internet"  2200
"2005"  "education" 201
"2005"  "food & drink"  324
"2005"  "grab bag"  248
"2005"  "health & fitness"  590
    </code></pre>
</section>

<section style="text-align:center;padding-top:3em;">
<img src="img/final.png" style="width:100%"/>
</section>

<section style="text-align:center;padding-top:1em;">
    <pre ><code class="language-javascript">
"year"  "category"  "n"
"2004"  "clothing, beauty, & fashion"   141
"2004"  "computers & internet"  2489
"2004"  "education" 151
"2005"  "clothing, beauty, & fashion"   203
"2005"  "computers & internet"  2200
"2005"  "education" 201
"2005"  "food & drink"  324
"2005"  "grab bag"  248
"2005"  "health & fitness"  590
    </code></pre>
</section>

<section style="text-align:center;padding-top:1em;font-size:80%;">
    <pre><code class="language-javascript">[
  {"key":"clothing, beauty, & fashion",
   "values":
     [{"year":"2004", "n":141, "date":"2004-01-01"},
      {"year":"2005", "n":203, "date":"2005-01-01"},...]
  },
  {"key":"computers & internet",
   "values":
     [{"year":"2004", "n":2489, "date":"2004-01-01"},
      {"year":"2005", "n":2200, "date":"2005-01-01"},...]
  },
  ...
]
    </code></pre>
</section>

<section style="text-align:center;padding-top:5em;font-size:90%;">
    <pre><code class="language-javascript">data = d3.nest()
  .key(function(d) { return d.category;})
  .sortValues(function(a, b) {
    return d3.ascending(a.date, b.date);
  })
  .entries(rawData);
    </code></pre>
</section>

<section style="text-align:center;padding-top:1em;font-size:80%;">
    <pre><code class="language-javascript">[
  {"key":"clothing, beauty, & fashion",
   "values":
     [{"year":"2004", "n":141, "date":"2004-01-01"},
      {"year":"2005", "n":203, "date":"2005-01-01"},...]
  },
  {"key":"computers & internet",
   "values":
     [{"year":"2004", "n":2489, "date":"2004-01-01"},
      {"year":"2005", "n":2200, "date":"2005-01-01"},...]
  },
  ...
]
    </code></pre>
</section>


<section style="text-align:center;padding-top:5em;font-size:90%;">
    <pre><code class="language-javascript">var div = d3.select("#vis")
  .selectAll(".chart")
  .data(data);
  
div.enter()
  .append("div")
  .attr("class", "chart")
  .append("svg").append("g");
    </code></pre>
</section>

<section style="padding-top:1em;">
<img src="img/image_mash/image_mash.001.png" style="width:100%"/>
</section>

<section style="padding-top:1em;">
<img src="img/image_mash/image_mash.002.png" style="width:100%"/>
</section>

<section style="padding-top:1em;">
<img src="img/image_mash/image_mash.003.png" style="width:100%"/>
</section>

<section style="text-align:center;padding-top:5em;font-size:90%;">
    <pre data-line="3,8"><code class="language-javascript">var div = d3.select("#vis")
  .selectAll(".chart")
  .data(data);
  
div.enter()
  .append("div")
  .attr("class", "chart")
  .append("svg").append("g");
    </code></pre>
</section>



<section  style="padding-top:3em;font-size:100%;">
    <pre ><code class="language-javascript">var svg = div.select("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom);

var g = svg
  .select("g")
  .attr("transform", "translate(" + margin.left + 
        "," + margin.top + ")");
    </code></pre>
</section>

<section  style="padding-top:5em;font-size:100%;">
    <pre data-line="3"><code class="language-javascript">g.append("rect")
  .attr("class", "background")
  .style("pointer-events", "all")
  .attr("width", width + margin.right)
  .attr("height", height);</code></pre>
</section>

<section style="text-align:center;padding-top:2em;">
    <pre><code class="language-css">.chart {
  float: left;
  padding-right: 5px;
  padding-bottom: 5px;
  padding-top: 0;
  padding-left: 0;
}

.background {
  fill: black;
}
    </code></pre>
  </section>

<section style="text-align:center;padding-top:0em;">
<img src="img/blocks.png" style="width:100%"/>
</section>

<section style="padding-top:1em;">
<img src="img/image_mash/image_mash.001.png" style="width:100%"/>
</section>

<section style="padding-top:1em;">
<img src="img/image_mash/image_mash.002.png" style="width:100%"/>
</section>

<section style="padding-top:1em;">
<img src="img/image_mash/image_mash.003.png" style="width:100%"/>
</section>

<section style="padding-top:1em;">
<img src="img/image_mash/image_mash.004.png" style="width:100%"/>
</section>

<section style="padding-top:1em;">
<img src="img/image_mash/image_mash.005.png" style="width:100%"/>
</section>

<section style="text-align:center;padding-top:3em;">
    <pre><code class="language-javascript">var line = d3.svg.line()
  .x(function(d) { return xScale(d.date); })
  .y(function(d) { return yScale(d.n); });

var area = d3.svg.area()
  .x(function(d) { return xScale(d.date); })
  .y0(height).y1(function(d) { return yScale(d.n); });

    </code></pre>
  </section>


<section style="padding-top:0em;">
    <pre data-line="6,12"><code class="language-javascript">lines = g.append("g");

lines.append("path")
  .attr("class", "area")
  .attr("d", function(c) {
    return area(c.values);
  });

lines.append("path")
  .attr("class", "line")
  .attr("d", function(c) {
    return line(c.values);
  });</code></pre>
</section>

<section style="padding-top:2em;">
  <pre> <code class="language-css">.area {
  fill: #cec6b9;
}

.line {
  fill: none;
  stroke: #74736c;
  stroke-width: 1.4px;
}
    
    </code></pre>
</section>

<section style="text-align:center;padding-top:0em;">
<img src="img/area.png" style="width:100%"/>
</section>

<section style="text-align:center;padding-top:0.5em;">
<img src="img/static.png" style="width:100%"/>
</section>

<section id="interactive" style="text-align:center;padding-top:5em;">
  <p class="title">Interactive</p>
  <svg id="intervis"></svg>
</section>


<section style="text-align:center;padding-top:5em;">
  <p class="title">Scrubbable</p>
</section>

<section  style="text-align:center;padding-top:3em;">
    <pre data-line="6,7,8"><code class="language-javascript">g.append("rect")
  .attr("class", "background")
  .style("pointer-events", "all")
  .attr("width", width + margin.right)
  .attr("height", height)
  .on("mouseover", mouseover)
  .on("mousemove", mousemove)
  .on("mouseout", mouseout);
    </code></pre>
</section>

<section  style="text-align:center;padding-top:3em;">
    <pre ><code class="language-javascript">// hide for now
  circle = lines.append("circle")
    .attr("r", 2.2)
    .attr("opacity", 0)
    </code></pre>
</section>

<section  style="padding-top:3em;font-size:100%;">
    <pre data-line="2"><code class="language-javascript">var mouseover = function() {
  circle.attr("opacity", 1.0);
  d3.selectAll(".static_year")
    .classed("hidden", true);
  return mousemove.call(this);
};
    </code></pre>
</section>

<section  style="padding-top:3em;font-size:100%;">
    <pre data-line="3"><code class="language-javascript">var mouseout = function() {
  circle.attr("opacity", 0);
  d3.selectAll(".static_year")
    .classed("hidden", false);

  caption.text("");
  curYear.text("");
  return true;
};
    </code></pre>
</section>

<section  style="text-align:center;padding-top:1em;font-size:80%;">
    <pre data-line="4,5"><code class="language-javascript">var mousemove = function() {
  // 'this' is current DOM element
  var xpos = d3.mouse(this)[0];
  var date = xScale.invert(xpos);
  var index = 0;

  circle
    .attr("cx", xScale(date))
    .attr("cy", function(c) {
      index = findIndex(c.values, date);
      return yScale(c.values[index].n);
  });
  //...
}
    </code></pre>
</section>

<section  style="padding-top:5em;font-size:100%;">
    <pre ><code class="language-javascript">var format = d3.time.format("%Y");
    
var xScale = d3.time.scale()
  .domain([format.parse("2013"), format.parse("2014")]);
  .range([0, width])
    </code></pre>
</section>


<section id="inverter" style="text-align:center;padding-top:5em;">
  <svg id="invertervis"></svg>
</section>

<section  style="text-align:center;padding-top:1em;font-size:90%;">
    <pre data-line="8"><code class="language-javascript">var mousemove = function() {
  // 'this' is current DOM element
  var xpos = d3.mouse(this)[0];
  var date = xScale.invert(xpos);
  var index = 0;

  circle
    .attr("cx", xScale(date))
    .attr("cy", function(c) {
      index = findIndex(c.values, date);
      return yScale(c.values[index].n);
  });
  //...
}</code></pre>
</section>

<section  style="text-align:center;padding-top:1em;font-size:90%;">
    <pre data-line="10,11"><code class="language-javascript">var mousemove = function() {
  // 'this' is current DOM element
  var xpos = d3.mouse(this)[0];
  var date = xScale.invert(xpos);
  var index = 0;

  circle
    .attr("cx", xScale(date))
    .attr("cy", function(c) {
      index = findIndex(c.values, date);
      return yScale(c.values[index].n);
  });
  //...
}</code></pre>
</section>

<section  style="text-align:center;padding-top:1em;font-size:80%;">
    <pre data-line=""><code class="language-javascript">// find location in 'array' with
// date nearest to 'date'
var findIndex = function(array, date) {
  var found = false;
  var index = 1;
  while (!found && index < array.length ) {
    if(array[index].date > date) {
      found = true;
    } else {
      index++;
    }
  }

  return index - 1;
};
    </code></pre>
</section>

<section  style="text-align:center;padding-top:1em;font-size:90%;">
    <pre data-line=""><code class="language-javascript">var mousemove = function() {
  // 'this' is current DOM element
  var xpos = d3.mouse(this)[0];
  var date = xScale.invert(xpos);
  var index = 0;

  circle
    .attr("cx", xScale(date))
    .attr("cy", function(c) {
      index = findIndex(c.values, date);
      return yScale(c.values[index].n);
  });
  //...
}</code></pre>
</section>

<section  style="text-align:center;padding-top:4em;">
    <pre data-line=""><code class="language-javascript">//create bisector
// (binary search)
var bisect = d3.bisector(function(d) { return d.date; })
  .left;
    </code></pre>
</section>

<section  style="text-align:center;padding-top:1em;font-size:80%;">
    <pre data-line="11"><code class="language-javascript">//with bisector
var mousemove = function() {
  // 'this' is current DOM element
  var xpos = d3.mouse(this)[0];
  var date = xScale.invert(xpos);
  var index = 0;

  circle
    .attr("cx", xScale(date))
    .attr("cy", function(c) {
      index = bisect(c.values, date, 0, c.values.length - 1);
      return yScale(c.values[index].n);
  });
  //...
}
    </code></pre>
</section>

<section style="text-align:center;padding-top:3em;background:url(img/magic.gif);background-size:auto; background-repeat:repeat;">
<!-- <img src="img/deaths_1870_inset.png" style="width:100%"/> -->
</section>

<section style="text-align:center;padding-top:1em;font-size:80%;">
    <pre data-line="4,5"><code class="language-javascript">[
  {"key":"clothing, beauty, & fashion",
   "values":
     [{"year":"2004", "n":141, "date":"2004-01-01"},
      {"year":"2005", "n":203, "date":"2005-01-01"},...]
  },
  {"key":"computers & internet",
   "values":
     [{"year":"2004", "n":2489, "date":"2004-01-01"},
      {"year":"2005", "n":2200, "date":"2005-01-01"},...]
  },
  ...
]
    </code></pre>
</section>

<section style="text-align:center;padding-top:3em;background:url(img/broken.png);background-size:cover;">
<!-- <img src="img/deaths_1870_inset.png" style="width:100%"/> -->
</section>


<section  style="text-align:center;padding-top:0em;font-size:80%;">
    <pre data-line="6,7"><code class="language-javascript">var format = d3.time.format("%Y");

var mousemove = function() {
  // 'this' is current DOM element
  var xpos = d3.mouse(this)[0];
  var year = xScale.invert(xpos).getFullYear();
  var date = format.parse('' + year);
  var index = 0;

  circle
    .attr("cx", xScale(date))
    .attr("cy", function(c) {
      index = bisect(c.values, date, 0, c.values.length - 1);
      return yScale(c.values[index].n);
  });
  //...
}</code></pre>
</section>


<section style="text-align:center;padding-top:5em;">
  <p class="title">Sortable</p>
</section>

<section style="text-align:center;padding-top:3em;background:url(img/isotope.png);background-size:cover;">
<!-- <img src="img/deaths_1870_inset.png" style="width:100%"/> -->
</section>

<section style="text-align:center;padding-top:0em;font-size:70%;">
    <pre ><code class="language-javascript">var setupIsoytpe = function() {
  $("#vis").isotope({
    itemSelector: '.chart',
    layoutMode: 'fitRows',
    getSortData: {
    }
  });
};</code></pre>
</section>

<section style="text-align:center;padding-top:0em;font-size:70%;">
    <pre><code class="language-javascript">var setupIsoytpe = function() {
  $("#vis").isotope({
    itemSelector: '.chart',
    layoutMode: 'fitRows',
    getSortData: {
      count: function(e) {
        var d = d3.select(e).datum();
        var sum = d3.sum(d.values, function(d) {
          return d.n;
        });
        return sum * -1;
      }    
    }
  });
};</code></pre>
</section>

<section style="text-align:center;padding-top:0em;font-size:70%;">
    <pre><code class="language-javascript">var setupIsoytpe = function() {
  $("#vis").isotope({
    itemSelector: '.chart',
    layoutMode: 'fitRows',
    getSortData: {
      count: function(e) {
        var d = d3.select(e).datum();
        var sum = d3.sum(d.values, function(d) {
          return d.n;
        });
        return sum * -1;
      },
      name: function(e) {
        var d = d3.select(e).datum();
        return d.key;
      }
    }
  });
};</code></pre>
</section>


<section  style="text-align:center;padding-top:5em;">
    <pre ><code class="language-javascript">$("#vis").isotope({sortBy: 'count'});
    </code></pre>
</section>

<section style="text-align:center;padding-top:3em;font-size:90%;">
    <pre ><code class="language-javascript">d3.select("#button-wrap")
  .selectAll("div")
  .on("click", function() {
    var id = d3.select(this).attr("id");

    $("#vis").isotope({sortBy: id});
    // ...
  });
});
    </code></pre>
</section>


<section style="text-align:center;padding-top:1em;">
<img src="img/final.png" style="width:100%"/>
    <p class="caption"><a href="https://github.com/vlandham/small_mults">github.com/vlandham/small_mults</a></p>
</section>

<section style="text-align:center;padding-top:1em;">
<img src="img/final.png" style="width:100%"/>
    <p class="caption"><a href="http://vallandingham.me/small_mults/">vallandingham.me/small_mults/</a></p>
</section>


<section id="lorenz" style="text-align:center;padding-top:0;">
  <canvas></canvas>
  <p class="title">Thanks</p>
  </section>

<section style="text-align:center;padding-top:0;">
  </section>

<script src="js/prism.js"></script>
<script src="js/d3.min.js"></script>
<script src="js/cubehelix.js"></script>
<script src="js/stack.v1.min.js"></script>
<script>

// Inspired by Lee Byron's test data generator.
function bumpLayer(n, o) {

  function bump(a) {
    var x = 1 / (.1 + Math.random()),
        y = 2 * Math.random() - .5,
        z = 10 / (.1 + Math.random());
    for (var i = 0; i < n; i++) {
      var w = (i / n - y) * z;
      a[i] += x * Math.exp(-w * w);
    }
  }

  var a = [], i;
  for (i = 0; i < n; ++i) a[i] = o + o * Math.random();
  for (i = 0; i < 5; ++i) bump(a);
  return a.map(function(d, i) { return {x: i, y: Math.max(0, d)}; });
}


// http://stackoverflow.com/questions/1527803/generating-random-numbers-in-javascript-in-a-specific-range
function getRandomArbitrary(min, max) {
    return Math.random() * (max - min) + min;
}


/**
 * Returns a random integer between min (inclusive) and max (inclusive)
 * Using Math.round() will give you a non-uniform distribution!
 */
function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}


var mystack = stack()
    .on("activate", activate)
    .on("deactivate", deactivate);

var section = d3.selectAll("section"),
    follow = d3.select("#follow"),
    followAnchor = d3.select("#follow-anchor"),
    lorenz = d3.select("#lorenz"),
    inverter = d3.select("#inverter"),
    interactive = d3.select("#interactive"),
    followIndex = section[0].indexOf(follow.node()),
    lorenzIndex = section[0].indexOf(lorenz.node());
    interIndex = section[0].indexOf(interactive.node());
    inverterIndex = section[0].indexOf(inverter.node());

function refollow() {
  followAnchor.style("top", (followIndex + (1 - mystack.scrollRatio()) / 2 - d3.event.offset) * 100 + "%");
}

function startVideo(i) {
  var video = section.filter(function(d,j) { return i == j; }).select("video");
  video.each(function(d,j) {
      this.play();
  });
}

function stopVideo(i) {
  var video = section.filter(function(d,j) { return i == j; }).select("video");
  video.each(function(d,j) {
      this.pause();
  });
}

function activate(d, i) {
  if (i === followIndex) mystack.on("scroll.follow", refollow);
  // if (i === lorenzIndex) startLorenz();
  if (i === interIndex) startInteractive();
  if (i === inverterIndex) startInverter();
  startVideo(i);
  setPageNumber(i);
}

function deactivate(d, i) {
  if (i === followIndex) mystack.on("scroll.follow", null);
  // if (i === lorenzIndex) stopLorenz();
  if (i === interIndex) stopInteractive();
  if (i === inverterIndex) stopInverter();
  stopVideo(i);
}
function stopInverter() {
  var vis = d3.select("#invertervis")
  d3.selectAll(vis.node().childNodes)
    .remove()
}

function setPageNumber(i) {
 d3.select("#pagenumber").html(i + 1);
}

function startInverter() {
  var width = 1280,
  height = 720;

  width = window.innerWidth;
  height = window.innerHeight;
  var xpadding = Math.round(width / 8);
  var ystart = Math.round(height / 4);
  var rectHeight = Math.round(height / 4);

  var format = d3.time.format("%Y");
  var xScale = d3.time.scale()
  .range([0, width - xpadding ])
  .domain([format.parse("2013"), format.parse("2014")]);
  var cScale = d3.scale.cubehelix()
  .range([d3.hsl(276, .6, 0.2), d3.hsl(96, .6, 0.9)])
  .domain([0, width - xpadding])

  var line, rect;
  var date_string, color_string, raw_string;
  var years = ["2013", "2014"];
  var vis = d3.select("#invertervis")
    .style("position", "absolute")
    .style("top", 0)
    .style("left", 0)
    .style("width", "100%")
    .style("height", "100%");
  vis.attr("width", width)
    .attr("height", height);
  var mouseover = function(e) {
      var xpos = d3.mouse(this)[0];
      var date = xScale.invert(xpos);
      var color = cScale(xpos);
      line.attr("x1", function() { return xScale(date) });
      line.attr("x2", function() { return xScale(date) });
      date_string.text(date.toLocaleDateString());
      raw_string.text(xpos);
      raw_string.attr("x", xScale(date));
      //color_string.text(color);
      rect.attr("fill", color);
    };
    g = vis.append("g")
    .attr("transform", "translate(" + Math.round(width / 2 - ((width - xpadding) / 2)) + "," +ystart + ")")
    //.attr("x", Math.round(width / 2 - ((width - xpadding) / 2)))
    //.attr("y", ystart )
    rect = g.append("rect")
    .attr("width", width - xpadding)
    .attr("height", rectHeight)
    .attr("x", 0)
    .attr("y", 0 )
    .attr("fill", "#777")
    .style("pointer-events", "all")
    .on("mousemove", mouseover)

  line = g.append("line")
    .attr("y1", 0 )
    .attr("y2",  rectHeight)
    .style("pointer-events", "none")
    .attr("stroke-width", 4)
    .attr("stroke", "black");

  date_string = vis.append("text")
  .attr("x", width / 2 - ((width - (width / 8)) / 2))
  .attr("y", ystart - 20 )
  // .attr("text-anchor", "middle")
  .attr("font-size", "55")

  year_string = vis.selectAll(".year")
    .data(years)
  year_string.enter()
    .append("text")
    .attr("class", "year")
    .attr("fill", "white")
    .attr("pointer-events", "none")
    .attr("x", function(d,i) { return (i == 0) ? (width / 2 - ((width - (width / 8)) / 2)) + 20 : (width - (xpadding + 20)); })
    .attr("y", ystart + (rectHeight - 20))
    .text(function(d) { return d; });
      

  color_string = vis.append("text")
  .attr("x", width - xpadding / 2)
  .attr("y", ystart - 20)
  .attr("text-anchor", "end")
  .attr("font-size", "55")

  raw_string = g.append("text")
  .attr("y", rectHeight)
  .attr("dy", 46)
  .attr("text-anchor", "middle")
  .attr("font-size", "55")

}

var interInterval;
function startInteractive() {
  var width = 1280,
      height = 720;
  width = window.innerWidth;
  height = window.innerHeight;

  var data = [];
  var count = 30;
  var size = 80;
  for(var i = 0; i < count; i++) {
    var x = (width / size) + (i * size);
    data.push({x:x,y:getRandomInt(0,height), dir:Math.random() > 0.4});
  }


  var vis = d3.select("#intervis")
      .style("position", "absolute")
      .style("top", 0)
      .style("left", 0)
      .style("width", "100%")
      .style("height", "100%");

      vis.attr("width", width)
      .attr("height", height);

  var animate = function () {
    data.forEach(function(d) {
      /* var param = (d.dir) ? width : height; */
      /* d[d.dir ? 'x' : 'y'] = getRandomInt(20, (param - 20)); */
      d.y = getRandomInt(size, (height - size));
      d.dir = !d.dir;
      vis.selectAll("circle").data(data)
        .transition()
        .duration(2000)
        .delay(function(d,i) { return i * 100; })
        .ease("exp-out")
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });

      });
    interInterval = setTimeout(animate, 2000);

  };


  vis.selectAll("circle").data(data)
    .enter().append("circle")
    .attr("r", 40)
    .attr("fill", "#888")
    .attr("opacity", 0.6)
    .attr("cx", function(d) { return d.x; })
    .attr("cy", function(d) { return d.y; });

  animate();

}

function stopInteractive() {
  interInterval = clearInterval(interInterval);
}

var lorenzInterval;

function startLorenz() {
  var δτ = 0.003,
      ρ = 28,
      σ = 10,
      β = 8 / 3,
      x = .5,
      y = .5,
      z = 10,
      n = 30;

  var width = 1280,
      height = 720;

  var canvas = d3.select("canvas")
      .style("position", "absolute")
      .style("top", 0)
      .style("left", 0)
      .style("width", "100%")
      .style("height", "100%")
      .attr("width", width)
      .attr("height", height);

  var color = d3.scale.linear()
      .domain([0, 20, 30, 50])
      .range(["yellow", "orange", "brown", "purple"])
      .interpolate(d3.interpolateHcl);

  var context = canvas.node().getContext("2d");

  context.lineWidth = .2;
  context.fillStyle = "rgba(0,0,0,.03)";

  d3.timer(function() {
    context.save();
    context.globalCompositeOperation = "lighter";
    context.translate(width / 2, height / 2);
    context.scale(12, 14);
    context.rotate(30);
    for (var i = 0; i < n; ++i) {
      context.strokeStyle = color(z);
      context.beginPath();
      context.moveTo(x, y);
      x += δτ * σ * (y - x);
      y += δτ * (x * (ρ - z) - y);
      z += δτ * (x * y - β * z);
      context.lineTo(x, y);
      context.stroke();
    }
    context.restore();
    return !lorenzInterval;
  });

  lorenzInterval = setInterval(function() {
    context.fillRect(0, 0, width, height);
  }, 100);
}

function stopLorenz() {
  lorenzInterval = clearInterval(lorenzInterval);
}

</script>
